---
driver:
  name: vagrant

provisioner:
  name: chef_zero
  require_chef_omnibus: 14.12.3
  chef_omnibus_install_options: -d /tmp/vagrant-cache/

verifier:
  name: inspec

platforms:
  - name: ubuntu-18.04-dockerized
    driver:
      provider: docker
      box: tknerr/baseimage-ubuntu-18.04
    lifecycle:
      pre_converge:
        # install net-tools which are required (but missing in the docker baseimage) for testing listen ports etc
        - remote: sudo apt-get install net-tools -y
        # inject a functional systemctl replacement so that we can run and test services like apache2 in the docker baseimage
        - remote: sudo wget -O /bin/systemctl https://raw.githubusercontent.com/gdraheim/docker-systemctl-replacement/master/files/docker/systemctl.py

suites:
  - name: default
    run_list:
      - recipe[myapp::default]
    verifier:
      inspec_tests:
        - test/integration/default
    attributes: